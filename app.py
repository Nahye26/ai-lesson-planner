import streamlit as st
import random

# -------------------
# ìˆ˜ì—… ëª©í‘œ
lesson_goals = [
    "ìì—° í˜„ìƒê³¼ ì¼ìƒìƒí™œì— ëŒ€í•œ í¥ë¯¸ì™€ í˜¸ê¸°ì‹¬ì„ ë°”íƒ•ìœ¼ë¡œ ë¬¸ì œë¥¼ ì¸ì‹í•˜ê³  í•´ê²°í•˜ëŠ” íƒœë„ í•¨ì–‘",
    "ê³¼í•™ íƒêµ¬ ë°©ë²•ì„ ì´í•´í•˜ê³  ë¬¸ì œë¥¼ ê³¼í•™ì ìœ¼ë¡œ íƒêµ¬í•˜ëŠ” ëŠ¥ë ¥ ê¸°ë¥´ê¸°",
    "ìƒíƒœê³„ì˜ ê°œë…ì„ ì´í•´í•˜ê³  í™˜ê²½ ë¬¸ì œ í•´ê²° ì˜ì§€ í•¨ì–‘",
    "ê³¼í•™ê³¼ ê¸°ìˆ  ë° ì‚¬íšŒì˜ ìƒí˜¸ ê´€ê³„ë¥¼ ì´í•´í•˜ê³  ì°¸ì—¬ì  ì‹œë¯¼ì˜ì‹ ê¸°ë¥´ê¸°"
]

# ìˆ˜ì—… ë°©ì‹ë³„ í™œë™ ì˜ˆì‹œ (íƒêµ¬, í™œë™, ê°œë…)
lesson_activities = {
    "íƒêµ¬": {
        "ì „ë°˜ë¶€": [("í¥ë¯¸ ìœ ë°œ ì˜ìƒ ì‹œì²­", ["í”„ë¡œì í„°", "ì˜ìƒ ìë£Œ"]), ("í™˜ê²½ ë¬¸ì œ ì‚¬ë¡€ ì´ì•¼ê¸°", ["ì‹ ë¬¸ ìŠ¤í¬ë©", "êµì‚¬ìš© ìë£Œ"])],
        "ì¤‘ë°˜ë¶€": [("ìƒíƒœê³„ ì˜¤ì—¼ ì‹¤í—˜ í™œë™", ["í˜íŠ¸ë³‘", "í† ì–‘ ìƒ˜í”Œ", "ë¹„ì»¤"]), ("ì¡°ì‚¬ í™œë™ ë° ë°œí‘œ", ["íƒêµ¬ ë…¸íŠ¸", "ë§ˆì´í¬", "í¬ìŠ¤íŠ¸ì‡"])],
        "í›„ë°˜ë¶€": [("í™˜ê²½ ìº í˜ì¸ ì—­í• ê·¹", ["ì—­í•  ëª…ì°°", "ì†Œí’ˆ"]), ("í† ë¡  í™œë™", ["í† ë¡  ì£¼ì œ ì¹´ë“œ", "íƒ€ì´ë¨¸"])]
    },
    "í™œë™": {
        "ì „ë°˜ë¶€": [("ê°„ë‹¨í•œ í€´ì¦ˆë¡œ ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹", ["í€´ì¦ˆì§€", "í™”ì´íŠ¸ë³´ë“œ"]), ("ìƒíƒœê³„ ê´€ë ¨ ì‹œê° ìë£Œ ì œê³µ", ["ì‚¬ì§„ ìë£Œ", "ë¹”ìŠ¤í¬ë¦°"])],
        "ì¤‘ë°˜ë¶€": [("ë¨¹ì´ì‚¬ìŠ¬ ëª¨í˜• ë§Œë“¤ê¸°", ["ì¢…ì´, ê°€ìœ„, í’€", "ìƒë¬¼ ì¹´ë“œ"]), ("í™˜ê²½ ë³´í˜¸ ì•„ì´ë””ì–´ ë¸Œë ˆì¸ìŠ¤í† ë°", ["ì¹ íŒ", "ë§ˆì¸ë“œë§µ ë„êµ¬"])],
        "í›„ë°˜ë¶€": [("í€´ì¦ˆ ë˜ëŠ” ê²Œì„", ["ë¬¸ì œ ì¹´ë“œ", "ìŠ¤í”¼ë“œ í€´ì¦ˆ ë„êµ¬"]), ("ê³¼í•™ ê¸€ì“°ê¸°", ["í•™ìŠµì§€", "ë…¸íŠ¸"])]
    },
    "ê°œë…": {
        "ì „ë°˜ë¶€": [("ìƒíƒœê³„ ê´€ë ¨ ì‹œê° ìë£Œ ì œê³µ", ["ì‚¬ì§„ ìë£Œ", "ë¹”ìŠ¤í¬ë¦°"]), ("í¥ë¯¸ ìœ ë°œ ì˜ìƒ ì‹œì²­", ["í”„ë¡œì í„°", "ì˜ìƒ ìë£Œ"])],
        "ì¤‘ë°˜ë¶€": [("ê³¼í•™ ì›ë¦¬ ì„¤ëª…", ["êµì‚¬ìš© ìë£Œ", "í™”ì´íŠ¸ë³´ë“œ"]), ("ê°œë… ì •ë¦¬ í€´ì¦ˆ", ["í€´ì¦ˆì§€"])],
        "í›„ë°˜ë¶€": [("ê³¼í•™ ê¸€ì“°ê¸°", ["í•™ìŠµì§€", "ë…¸íŠ¸"]), ("í† ë¡  í™œë™", ["í† ë¡  ì£¼ì œ ì¹´ë“œ", "íƒ€ì´ë¨¸"])]
    }
}

# ê¸°ë³¸ ì¶”ì²œ ì‹œê°„ ë°°ë¶„ (ë‹¨ìœ„: ë¶„)
default_time_distribution = {
    "ì „ë°˜ë¶€": 10,
    "ì¤‘ë°˜ë¶€": 15,
    "í›„ë°˜ë¶€": 15
}

# -------------------
# ìˆ˜ì—… ê³„íš ìƒì„± í•¨ìˆ˜
def generate_lesson_plan(topic, approach, time_dist):
    goal = random.choice(lesson_goals)
    plan = {
        "ì£¼ì œ": topic,
        "ëª©í‘œ": goal,
        "ì‹œê°„ë°°ë¶„": time_dist
    }
    for phase in ["ì „ë°˜ë¶€", "ì¤‘ë°˜ë¶€", "í›„ë°˜ë¶€"]:
        methods_tools = lesson_activities[approach][phase]
        method, tools = random.choice(methods_tools)
        plan[phase] = {
            "í™œë™": method,
            "ë„êµ¬": tools
        }
    return plan

# -------------------
# ìˆ˜ì—… ì„¤ê³„ ê·¼ê±° ë° ì´ìœ  ìë™ ìƒì„± í•¨ìˆ˜
def generate_rationale(topic, goal, activities, time_dist):
    rationale = f"ì´ë²ˆ ìˆ˜ì—… ì£¼ì œëŠ” '{topic}'ì…ë‹ˆë‹¤. ì£¼ìš” í•™ìŠµ ëª©í‘œëŠ” '{goal}'ì´ë©°, ì´ëŠ” í•™ìƒë“¤ì´ ê³¼í•™ íƒêµ¬ ëŠ¥ë ¥ê³¼ í™˜ê²½ ë¬¸ì œì— ëŒ€í•œ ì°¸ì—¬ ì˜ì‹ì„ ê¸°ë¥´ë„ë¡ ë•ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.\n\n"
    rationale += "ìˆ˜ì—…ì€ ì „ë°˜ë¶€, ì¤‘ë°˜ë¶€, í›„ë°˜ë¶€ë¡œ ë‚˜ëˆ„ì–´ êµ¬ì„±í•˜ì˜€ê³ , ê° ë‹¨ê³„ë³„ í™œë™ ì„ ì •ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ê°€ ìˆìŠµë‹ˆë‹¤:\n"
    for phase in ["ì „ë°˜ë¶€", "ì¤‘ë°˜ë¶€", "í›„ë°˜ë¶€"]:
        activity = activities[phase]['í™œë™']
        tools = ", ".join(activities[phase]['ë„êµ¬'])
        rationale += f"- [{phase} ({time_dist[phase]}ë¶„)] '{activity}' í™œë™ì€ í•™ìƒë“¤ì˜ í¥ë¯¸ì™€ ì°¸ì—¬ë¥¼ ìœ ë„í•˜ê³  í•™ìŠµ íš¨ê³¼ë¥¼ ë†’ì´ê¸° ìœ„í•´ '{tools}' ë„êµ¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\n"
    rationale += "\nì´ëŸ¬í•œ êµ¬ì„±ì€ í•™ìƒë“¤ì˜ ì§‘ì¤‘ë ¥ê³¼ ì°¸ì—¬ë„ë¥¼ ë†’ì´ê³ , ë‹¨ê³„ë³„ë¡œ í•™ìŠµ ëª©í‘œë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ë‹¬ì„±í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤."
    return rationale

# -------------------
# Streamlit UI ì‹œì‘
st.set_page_config(page_title="AI ìˆ˜ì—… ì„¤ê³„ê¸° - íƒêµ¬/í™œë™/ê°œë… ì„ íƒ ë° ì‹œê°„ë°°ë¶„", layout="wide")
st.title("ğŸ“˜ AI ìˆ˜ì—… ì„¤ê³„ê¸°")

st.header("1ï¸âƒ£ ìˆ˜ì—… ì£¼ì œ ì…ë ¥")
topic = st.text_input("ìˆ˜ì—… ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ìƒë¬¼ê³¼ í™˜ê²½)")

st.header("2ï¸âƒ£ ìˆ˜ì—… ë°©ì‹ ì„ íƒ")
approach = st.radio("ì£¼ë¡œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì—…í• ê¹Œìš”?", options=["íƒêµ¬", "í™œë™", "ê°œë…"])

st.header("3ï¸âƒ£ ì‹œê°„ ë°°ë¶„ ì„ íƒ")
time_option = st.radio("ì‹œê°„ ë°°ë¶„ì„ ì„ íƒí•˜ì„¸ìš”", options=["ì¶”ì²œ ì‹œê°„ ë°°ë¶„ ì‚¬ìš©", "ì§ì ‘ ì‹œê°„ ë°°ë¶„ ì…ë ¥"])

if time_option == "ì¶”ì²œ ì‹œê°„ ë°°ë¶„ ì‚¬ìš©":
    time_dist = default_time_distribution
else:
    st.write("ë‹¨ìœ„: ë¶„")
    t1 = st.number_input("ì „ë°˜ë¶€ ì‹œê°„", min_value=1, max_value=40, value=10)
    t2 = st.number_input("ì¤‘ë°˜ë¶€ ì‹œê°„", min_value=1, max_value=40, value=15)
    t3 = st.number_input("í›„ë°˜ë¶€ ì‹œê°„", min_value=1, max_value=40, value=15)
    total = t1 + t2 + t3
    if total > 40:
        st.error("ì´ ì‹œê°„ì€ 40ë¶„ì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!")
        st.stop()
    time_dist = {"ì „ë°˜ë¶€": t1, "ì¤‘ë°˜ë¶€": t2, "í›„ë°˜ë¶€": t3}

if topic:
    plan = generate_lesson_plan(topic, approach, time_dist)
    rationale = generate_rationale(topic, plan["ëª©í‘œ"], plan, time_dist)

    st.subheader("ğŸ“‹ ìƒì„±ëœ ìˆ˜ì—…ì•ˆ")
    st.markdown(f"**ì£¼ì œ:** {plan['ì£¼ì œ']}")
    st.markdown(f"**ëª©í‘œ:** {plan['ëª©í‘œ']}")
    for phase in ["ì „ë°˜ë¶€", "ì¤‘ë°˜ë¶€", "í›„ë°˜ë¶€"]:
        tools_str = ", ".join(plan[phase]["ë„êµ¬"])
        st.markdown(f"- **{phase}** ({time_dist[phase]}ë¶„): {plan[phase]['í™œë™']}  ğŸ§° ë„êµ¬: {tools_str}")

    st.info(rationale)
else:
    st.info("ğŸ‘ˆ ìœ„ ì…ë ¥ë€ì— ìˆ˜ì—… ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
